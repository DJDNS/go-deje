<!DOCTYPE html>
<html>
<head>
    <title>DEJE WAMP demo</title>
    <style>

.log-container {
    background-color: #CCC;
    border: 2px solid black;
    width: 100%;
    min-height: 200px;
    border-radius: 10px;
}

pre {
    margin: 10px;
}

    </style>
    <script src="/autobahn.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
</head>

<body>
    <h1>DEJE WAMP demo</h1>
    <p>Start up a few clients, and then watch the logging output ensue!</p>
    <h3>Log</h3>
    <div class="log-container">
        <pre id="log"></pre>
    </div>
    <script>

URL   = "ws://localhost:8080/ws";
TOPIC = "http://demo/";

window.session = undefined;

function loggit(info) {
    $('#log').text( $('#log').text() + info + "\n" );
}

function on_msg(topic, msg) {
    loggit(topic + ": " + JSON.stringify(msg))
}

ab.connect(
    URL,
    function (session) {
        loggit("<your browser>: Connected to router")
        window.session = session;

        session.subscribe(TOPIC, on_msg);
    },
    function (code, reason, detail) {
        loggit("<your browser>: Disconnected from router")
        loggit("Err code " + code + ": " + reason)
        loggit(JSON.stringify(detail))
        window.session = undefined;
    }
);

    </script>
</body>
</html>
